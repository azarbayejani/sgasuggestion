var express = require('express');

var server = express.createServer();

var cas = require('../lib/index');
var auth = cas.getMiddleware('https://habor.acu.edu', 'http://150.252.8.99:8888');

server.configure(function(){
        server.use(express.cookieParser());
        server.use(express.session({ 'secret':'Modern Major General' }));
        server.use(server.router);
});
server.configure(function(){
        server.use(express.errorHandler());
});

server.get('/', auth, function(request,response){
        if(!request.session.authenticatedUser) {
                console.log("weird");
                console.dir(request.session);
        }
        var username = request.session.authenticatedUser.id;
        response.send("<html><head></head><body>Logged in as " + username + "</body></html>");
});

server.listen(8888)
